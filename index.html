<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام متابعة جودة التعليم والتعلم</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* الأنماط الأساسية (نفس الكود السابق) */
        :root {
            --primary: #2c5aa0;
            --primary-light: #4a7bc8;
            --secondary: #4caf50;
            --accent: #ff9800;
            --light: #f5f7fa;
            --dark: #333;
            --gray: #6c757d;
            --danger: #dc3545;
            --success: #28a745;
            --warning: #ffc107;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        body {
            background-color: #f0f2f5;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* باقي الأنماط (نفس الكود السابق) */
        /* ... */

        /* قسم إعدادات التقرير - الجديد */
        .report-settings-section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .report-settings-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
        }

        .report-settings-title {
            font-size: 1.8rem;
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .report-settings-subtitle {
            font-size: 1.2rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }

        .settings-tabs {
            display: flex;
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
        }

        .settings-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background-color: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            color: var(--gray);
        }

        .settings-tab.active {
            background-color: var(--primary);
            color: white;
        }

        .settings-tab:hover:not(.active) {
            background-color: #e9ecef;
        }

        .settings-tab-content {
            display: none;
        }

        .settings-tab-content.active {
            display: block;
        }

        .settings-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        .settings-table th, .settings-table td {
            padding: 12px 10px;
            text-align: right;
            border: 1px solid #ddd;
        }

        .settings-table th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
        }

        .settings-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .settings-table tr:hover {
            background-color: #e9ecef;
        }

        /* قسم تقرير جودة التعليم - محسّن */
        .quality-report-section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .quality-report-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
        }

        .quality-report-title {
            font-size: 1.8rem;
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .quality-report-subtitle {
            font-size: 1.2rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        .report-table th {
            background-color: var(--primary);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
        }

        .report-table td {
            padding: 10px 8px;
            border: 1px solid #ddd;
            text-align: center;
        }

        .report-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .report-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--light);
        }

        .report-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        .report-textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            min-height: 80px;
        }

        .report-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
        }

        .report-section-title {
            font-size: 1.3rem;
            color: var(--primary);
            margin-bottom: 1rem;
            font-weight: 700;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 0.5rem;
        }

        .saved-reports-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
        }

        .report-card {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            transition: transform 0.3s;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .report-card:hover {
            transform: translateY(-5px);
        }

        .report-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .report-card-title {
            font-size: 1.2rem;
            color: var(--primary);
            font-weight: 600;
        }

        .report-card-date {
            font-size: 0.9rem;
            color: var(--gray);
        }

        .report-card-content {
            margin-bottom: 1rem;
            flex-grow: 1;
        }

        .report-card-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 15px;
        }

        .report-card-stat {
            text-align: center;
            flex: 1;
        }

        .report-card-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            display: block;
        }

        .report-card-stat-label {
            font-size: 0.8rem;
            color: var(--gray);
            display: block;
            margin-top: 5px;
        }

        .report-card-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: auto;
        }

        .report-card-btn {
            padding: 10px 12px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            text-decoration: none;
            color: inherit;
        }

        .report-card-btn:hover {
            background-color: #e9ecef;
            transform: translateY(-2px);
        }

        .report-card-btn.view {
            color: var(--primary);
            border-color: var(--primary);
        }

        .report-card-btn.edit {
            color: var(--warning);
            border-color: var(--warning);
        }

        .report-card-btn.download {
            color: var(--success);
            border-color: var(--success);
        }

        .report-card-btn.delete {
            color: var(--danger);
            border-color: var(--danger);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--gray);
            grid-column: 1 / -1;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ddd;
        }

        /* نافذة المعاينة */
        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow: auto;
        }

        .preview-content {
            background-color: white;
            margin: 2% auto;
            width: 90%;
            max-width: 1000px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            position: relative;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
        }

        .preview-title {
            font-size: 1.5rem;
            color: var(--primary);
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }

        .close-btn:hover {
            color: var(--dark);
        }

        /* علامات التبويب لتقرير الجودة */
        .quality-tabs {
            display: flex;
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
        }

        .quality-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background-color: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            color: var(--gray);
        }

        .quality-tab.active {
            background-color: var(--primary);
            color: white;
        }

        .quality-tab:hover:not(.active) {
            background-color: #e9ecef;
        }

        .quality-tab-content {
            display: none;
        }

        .quality-tab-content.active {
            display: block;
        }

        .btn-loading {
            position: relative;
            pointer-events: none;
            opacity: 0.8;
        }

        .btn-loading::after {
            content: "جاري الحفظ...";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: inherit;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.6;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0.6;
            }
        }

        .report-notes {
            font-style: italic;
            color: var(--gray);
            margin-top: 1rem;
            text-align: center;
        }

        /* تنسيق A4 للطباعة */
        @media print {
            body * {
                visibility: hidden;
            }
            .preview-content, .preview-content * {
                visibility: visible;
            }
            .preview-content {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                max-width: none;
                margin: 0;
                padding: 0;
                box-shadow: none;
                border-radius: 0;
            }
            .report-page {
                width: 210mm;
                height: 297mm;
                page-break-after: always;
                padding: 20mm;
                margin: 0 auto;
                box-sizing: border-box;
                position: relative;
            }
            .report-header {
                text-align: center;
                margin-bottom: 20px;
                border-bottom: 2px solid #2c5aa0;
                padding-bottom: 15px;
            }
            .report-title {
                color: #2c5aa0;
                font-size: 24px;
                font-weight: bold;
                margin-bottom: 10px;
            }
            .report-subtitle {
                color: #6c757d;
                font-size: 18px;
                margin-bottom: 5px;
            }
            .report-table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 15px;
                font-size: 12px;
            }
            .report-table th, .report-table td {
                border: 1px solid #ddd;
                padding: 6px;
                text-align: center;
            }
            .report-table th {
                background-color: #2c5aa0;
                color: white;
                font-weight: bold;
            }
            .report-section-title {
                color: #2c5aa0;
                font-size: 16px;
                font-weight: bold;
                margin-top: 20px;
                margin-bottom: 10px;
                border-bottom: 1px solid #2c5aa0;
                padding-bottom: 5px;
            }
            .report-footer {
                position: absolute;
                bottom: 20mm;
                left: 20mm;
                right: 20mm;
                text-align: center;
                border-top: 1px solid #ddd;
                padding-top: 10px;
                font-size: 14px;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .report-settings-section,
            .quality-report-section {
                padding: 1rem;
            }
            
            .report-settings-title,
            .quality-report-title {
                font-size: 1.4rem;
            }
            
            .report-table {
                font-size: 0.8rem;
            }
            
            .report-table th,
            .report-table td {
                padding: 6px 4px;
            }
            
            .saved-reports-container {
                grid-template-columns: 1fr;
            }
            
            .report-card-actions {
                grid-template-columns: 1fr;
            }
            
            .settings-table {
                font-size: 0.8rem;
            }
            
            .settings-table th,
            .settings-table td {
                padding: 8px 4px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <h2 class="login-title">تسجيل الدخول</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">اسم المستخدم</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">كلمة المرور</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn btn-block">تسجيل الدخول</button>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app" style="display: none;">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-graduation-cap"></i>
                        <h1>نظام متابعة جودة التعليم والتعلم</h1>
                    </div>
                    <div class="user-info">
                        <div class="user-avatar" id="userAvatar">م</div>
                        <span id="userName">مستخدم</span>
                        <button id="logoutBtn" class="btn btn-danger">تسجيل الخروج</button>
                    </div>
                </div>
            </div>
        </header>

        <nav>
            <div class="container">
                <ul class="nav-tabs" id="navTabs">
                    <li><a href="#" data-section="dashboard" class="active">لوحة التحكم</a></li>
                    <li><a href="#" data-section="visits">الزيارات الصفية</a></li>
                    <li><a href="#" data-section="performance">تقييم الأداء</a></li>
                    <li><a href="#" data-section="teachers">المعلمين المتميزين</a></li>
                    <li><a href="#" data-section="reports">التقارير النوعية</a></li>
                    <li><a href="#" data-section="quality-report">تقرير جودة التعليم</a></li>
                    <li><a href="#" data-section="report-settings" id="reportSettingsTab" style="display: none;">إعدادات التقرير</a></li>
                    <li><a href="#" data-section="users" id="usersTab" style="display: none;">إدارة المستخدمين</a></li>
                </ul>
            </div>
        </nav>

        <main>
            <div class="container">
                <!-- Dashboard Section -->
                <section id="dashboard" class="section active">
                    <!-- محتوى لوحة التحكم (نفس الكود السابق) -->
                </section>

                <!-- Visits Section -->
                <section id="visits" class="section">
                    <!-- محتوى الزيارات الصفية (نفس الكود السابق) -->
                </section>

                <!-- Performance Section -->
                <section id="performance" class="section">
                    <!-- محتوى تقييم الأداء (نفس الكود السابق) -->
                </section>

                <!-- Teachers Section -->
                <section id="teachers" class="section">
                    <!-- محتوى المعلمين المتميزين (نفس الكود السابق) -->
                </section>

                <!-- Reports Section -->
                <section id="reports" class="section">
                    <!-- محتوى التقارير النوعية (نفس الكود السابق) -->
                </section>

                <!-- Quality Report Section - المحدث -->
                <section id="quality-report" class="section">
                    <div class="section-header">
                        <h2 class="section-title">تقرير جودة التعليم</h2>
                    </div>
                    
                    <div class="quality-tabs">
                        <button class="quality-tab active" data-tab="create-quality-report">إنشاء تقرير جديد</button>
                        <button class="quality-tab" data-tab="saved-quality-reports">التقارير المحفوظة</button>
                    </div>

                    <!-- صفحة إنشاء التقرير -->
                    <div id="create-quality-report" class="quality-tab-content active">
                        <div class="quality-report-section">
                            <div class="month-selector">
                                <label for="reportMonth">اختر الشهر:</label>
                                <select id="reportMonth">
                                    <option value="يناير">يناير</option>
                                    <option value="فبراير">فبراير</option>
                                    <option value="مارس">مارس</option>
                                    <option value="أبريل">أبريل</option>
                                    <option value="مايو">مايو</option>
                                    <option value="يونيو">يونيو</option>
                                    <option value="يوليو">يوليو</option>
                                    <option value="أغسطس">أغسطس</option>
                                    <option value="سبتمبر">سبتمبر</option>
                                    <option value="أكتوبر">أكتوبر</option>
                                    <option value="نوفمبر">نوفمبر</option>
                                    <option value="ديسمبر">ديسمبر</option>
                                </select>
                            </div>

                            <div class="quality-report-header">
                                <h2 class="quality-report-title">تقرير متابعة جودة التعليم والتعلم للقيادة العليا والوسطى</h2>
                                <p class="quality-report-subtitle" id="schoolNameHeader">لمدرسة ــــــــــــــــــــــــــــــــــــ</p>
                                <p class="quality-report-subtitle" id="reportMonthHeader">شهر ____________</p>
                                <p class="quality-report-subtitle" id="academicYearHeader">العام الدراسي 2025 / 2026م</p>
                                <p class="quality-report-subtitle">إعداد المدير/ة المساعد/ة /يعتمد، مدير/ة المدرسة</p>
                            </div>

                            <!-- أولاً: متابعة تسليم القيادة الوسطى -->
                            <div class="report-section">
                                <h3 class="report-section-title">أولاً: متابعة تسليم القيادة الوسطى (الزيارات/محاضر الاجتماعات /الخطة الأسبوعية) للمواد الدراسية الى المدير/ة المساعد/ة في المدرسة</h3>
                                <table class="report-table">
                                    <thead>
                                        <tr>
                                            <th>القسم</th>
                                            <th>عدد استمارات الزيارات الصفية التي نفذت من قبل المعلم الأول أو المنسق خلال الشهر</th>
                                            <th>يوجد محضر اجتماع المعلم الأول أو المنسق مع المعلمين</th>
                                            <th>توجد خطة أسبوعية للمعلم الأول أو المنسق</th>
                                            <th>أسباب عدم التسليم</th>
                                        </tr>
                                    </thead>
                                    <tbody id="middleLeadershipReportTable">
                                        <!-- سيتم ملؤها بالبيانات -->
                                    </tbody>
                                </table>
                                <p class="report-notes">ملاحظات عامة: يتم التنسيق مع القيادة الوسطى لتنفيذ الزيارات الصفية بحسب ما يتناسب مع ظروف الجداول والنصاب المسند لهم.</p>
                            </div>

                            <!-- ثانياً: عدد الزيارات -->
                            <div class="report-section">
                                <h3 class="report-section-title">ثانياً: عدد الزيارات التي نُفذت خلال شهر ____________ من قبل:</h3>
                                <div class="form-group">
                                    <label for="seniorLeadershipVisits">1- القيادة العليا =</label>
                                    <input type="number" id="seniorLeadershipVisits" class="report-input" min="0">
                                </div>
                                <div class="form-group">
                                    <label for="middleLeadershipVisits">2- القيادة الوسطى =</label>
                                    <input type="number" id="middleLeadershipVisits" class="report-input" min="0">
                                </div>
                            </div>

                            <!-- ثالثاً: أسماء المعلمين المُزارين -->
                            <div class="report-section">
                                <h3 class="report-section-title">ثالثاً: بيان أسماء المعلمين المُزارين من قبل القيادة العليا والوسطى خلال شهر ____________</h3>
                                <table class="report-table">
                                    <thead>
                                        <tr>
                                            <th>م</th>
                                            <th>اسم المعلم</th>
                                            <th>القسم</th>
                                            <th>تاريخ الزيارة</th>
                                            <th>تقييم الزيارة</th>
                                            <th>اسم الزائر</th>
                                        </tr>
                                    </thead>
                                    <tbody id="teacherVisitsReportTable">
                                        <!-- سيتم ملؤها بالبيانات -->
                                    </tbody>
                                </table>
                            </div>

                            <!-- أزرار التحميل -->
                            <div class="report-actions">
                                <button class="btn btn-success" id="saveQualityReport">
                                    <i class="fas fa-save"></i> حفظ التقرير
                                </button>
                                <button class="btn btn-secondary" id="previewQualityReport">
                                    <i class="fas fa-eye"></i> معاينة التقرير
                                </button>
                                <button class="btn btn-secondary" id="downloadWordReport">
                                    <i class="fas fa-file-word"></i> تحميل كملف Word
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- صفحة التقارير المحفوظة -->
                    <div id="saved-quality-reports" class="quality-tab-content">
                        <div class="quality-report-section">
                            <div class="quality-report-header">
                                <h2 class="quality-report-title">التقارير المحفوظة</h2>
                                <p class="quality-report-subtitle">عرض وإدارة التقارير المحفوظة سابقاً</p>
                            </div>

                            <div id="savedReportsContainer" class="saved-reports-container">
                                <!-- سيتم ملؤها بالتقارير المحفوظة -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Report Settings Section - الجديد -->
                <section id="report-settings" class="section">
                    <div class="section-header">
                        <h2 class="section-title">إعدادات التقرير</h2>
                    </div>
                    
                    <div class="settings-tabs">
                        <button class="settings-tab active" data-tab="quality-report-settings">إعدادات تقرير جودة التعليم</button>
                    </div>

                    <!-- صفحة إعدادات تقرير جودة التعليم -->
                    <div id="quality-report-settings" class="settings-tab-content active">
                        <div class="report-settings-section">
                            <div class="report-settings-header">
                                <h2 class="report-settings-title">إعدادات تقرير جودة التعليم</h2>
                                <p class="report-settings-subtitle">إعدادات الغلاف والزيارات الصفية</p>
                            </div>

                            <!-- إعدادات الغلاف -->
                            <div class="report-section">
                                <h3 class="report-section-title">إعدادات الغلاف</h3>
                                
                                <div class="form-group">
                                    <label for="schoolLogo">شعار الوزارة</label>
                                    <input type="file" id="schoolLogo" accept="image/*">
                                    <div id="logoPreview" style="margin-top: 10px;"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="schoolName">اسم المدرسة</label>
                                    <input type="text" id="schoolName" class="report-input" placeholder="أدخل اسم المدرسة">
                                </div>
                                
                                <div class="form-group">
                                    <label>يعتمد، مدير/ة المدرسة</label>
                                    <div class="table-header-actions">
                                        <button class="btn" id="addSchoolManager">إضافة اسم</button>
                                    </div>
                                    <table class="settings-table">
                                        <thead>
                                            <tr>
                                                <th>الترتيب</th>
                                                <th>الاسم</th>
                                                <th>الإجراءات</th>
                                            </tr>
                                        </thead>
                                        <tbody id="schoolManagersTable">
                                            <!-- سيتم ملؤها بالبيانات -->
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="form-group">
                                    <label>إعداد المدير/ة المساعد/ة</label>
                                    <div class="table-header-actions">
                                        <button class="btn" id="addAssistantManager">إضافة اسم</button>
                                    </div>
                                    <table class="settings-table">
                                        <thead>
                                            <tr>
                                                <th>الترتيب</th>
                                                <th>الاسم</th>
                                                <th>الإجراءات</th>
                                            </tr>
                                        </thead>
                                        <tbody id="assistantManagersTable">
                                            <!-- سيتم ملؤها بالبيانات -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- إعدادات الزيارات الصفية -->
                            <div class="report-section">
                                <h3 class="report-section-title">إعدادات الزيارات الصفية</h3>
                                <p>إعداد ترتيب أسماء الزوار من القيادة العليا والوسطى</p>
                                
                                <div class="table-header-actions">
                                    <button class="btn" id="addVisitor">إضافة زائر</button>
                                </div>
                                
                                <table class="settings-table">
                                    <thead>
                                        <tr>
                                            <th>الترتيب</th>
                                            <th>اسم الزائر</th>
                                            <th>الدور</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody id="visitorsTable">
                                        <!-- سيتم ملؤها بالبيانات -->
                                    </tbody>
                                </table>
                            </div>

                            <!-- إعدادات التذييل -->
                            <div class="report-section">
                                <h3 class="report-section-title">إعدادات التذييل</h3>
                                <div class="form-group">
                                    <label for="reportFooter">نص التذييل</label>
                                    <textarea id="reportFooter" class="report-textarea" placeholder="أدخل نص التذييل الذي سيظهر في جميع صفحات التقرير"></textarea>
                                </div>
                            </div>

                            <!-- أزرار الحفظ -->
                            <div class="report-actions">
                                <button class="btn btn-success" id="saveReportSettings">
                                    <i class="fas fa-save"></i> حفظ الإعدادات
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Users Management Section -->
                <section id="users" class="section">
                    <!-- محتوى إدارة المستخدمين (نفس الكود السابق) -->
                </section>
            </div>
        </main>
    </div>

    <!-- Modal for Adding/Editing Report Settings -->
    <div id="reportSettingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="reportSettingsModalTitle">إضافة إعداد</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="reportSettingsForm">
                <input type="hidden" id="settingId">
                <input type="hidden" id="settingType">
                <div class="form-group">
                    <label for="settingName">الاسم</label>
                    <input type="text" id="settingName" required>
                </div>
                <div class="form-group" id="settingRoleGroup" style="display: none;">
                    <label for="settingRole">الدور</label>
                    <select id="settingRole">
                        <option value="القيادة العليا">القيادة العليا</option>
                        <option value="القيادة">القيادة</option>
                    </select>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn">حفظ</button>
                    <button type="button" class="btn btn-secondary" id="cancelReportSetting">إلغاء</button>
                </div>
            </form>
        </div>
    </div>

    <!-- نافذة المعاينة لتقرير الجودة -->
    <div id="qualityPreviewModal" class="preview-modal">
        <div class="preview-content">
            <div class="preview-header">
                <h2 class="preview-title">معاينة التقرير</h2>
                <button class="close-btn" id="closeQualityPreview">&times;</button>
                <button class="btn btn-success" id="printQualityReport">
                    <i class="fas fa-print"></i> طباعة التقرير
                </button>
            </div>
            <div id="qualityPreviewContent">
                <!-- سيتم ملؤها بمحتوى التقرير -->
            </div>
        </div>
    </div>

    <script>
        // بيانات التطبيق - محدثة
        const appData = {
            currentUser: null,
            users: [
                // بيانات المستخدمين (نفس الكود السابق)
            ],
            departments: [
                // بيانات الأقسام (نفس الكود السابق)
            ],
            visits: [],
            performance: [],
            distinguishedTeachers: [],
            teachersNeedCare: [],
            reports: [],
            // بيانات تقرير الجودة
            qualityReportData: {
                schoolName: '',
                reportMonth: '',
                academicYear: '2025 / 2026م',
                middleLeadership: [],
                seniorLeadershipVisits: 0,
                middleLeadershipVisits: 0,
                teacherVisits: [],
                performance: [],
                distinguishedTeachers: [],
                teachersNeedCare: [],
                qualityReport: [],
                totalClassVisits: 0
            },
            // بيانات نموذجية لتقرير الجودة
            qualityReportSampleData: {
                seniorLeadershipVisits: 15,
                middleLeadershipVisits: 25,
                totalClassVisits: 40,
                middleLeadership: [
                    { department: 'معلم أول / منسق اللغة العربية', visits: 5, meeting: 'نعم', plan: 'نعم', reasons: '' },
                    { department: 'معلم أول/منسق رياضيات وعلوم', visits: 6, meeting: 'نعم', plan: 'نعم', reasons: '' },
                    { department: 'معلم اول/منسق اللغة الإنجليزية', visits: 4, meeting: 'نعم', plan: 'لا', reasons: 'انشغال المنسق' },
                    { department: 'معلم أول/منسق تربية اسلامية', visits: 5, meeting: 'نعم', plan: 'نعم', reasons: '' },
                    { department: 'معلم اول/منسق المواد الاجتماعية', visits: 3, meeting: 'لا', plan: 'نعم', reasons: 'تأخر في التسليم' },
                    { department: 'معلم أول/منسق نظام فصل', visits: 4, meeting: 'نعم', plan: 'نعم', reasons: '' },
                    { department: 'منسق المواد الإثرائية', visits: 2, meeting: 'نعم', plan: 'نعم', reasons: '' },
                    { department: 'منسق التربية الرياضية', visits: 3, meeting: 'نعم', plan: 'نعم', reasons: '' }
                ],
                teacherVisits: [
                    { teacher: 'أحمد محمد', department: 'اللغة العربية', date: '2025-03-15', evaluation: 'ممتاز', visitor: 'مدير المدرسة' },
                    { teacher: 'فاطمة عبدالله', department: 'الرياضيات', date: '2025-03-18', evaluation: 'جيد جداً', visitor: 'نائب المدير' },
                    { teacher: 'خالد إبراهيم', department: 'العلوم', date: '2025-03-20', evaluation: 'ممتاز', visitor: 'مدير المدرسة' },
                    { teacher: 'سارة علي', department: 'اللغة الإنجليزية', date: '2025-03-22', evaluation: 'جيد', visitor: 'نائب المدير' },
                    { teacher: 'محمد حسن', department: 'التربية الإسلامية', date: '2025-03-25', evaluation: 'جيد جداً', visitor: 'مدير المدرسة' }
                ]
            },
            // بيانات إعدادات التقرير - الجديدة
            reportSettings: {
                schoolName: '',
                schoolLogo: '',
                schoolManagers: [],
                assistantManagers: [],
                visitors: [],
                reportFooter: 'إدارة العمليات التعليمية المنطقة (1) رئيس مدارس. أفنان محمد أمين'
            }
        };

        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            // محاولة استعادة حالة تسجيل الدخول من localStorage
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                const userData = JSON.parse(savedUser);
                const user = appData.users.find(u => u.id === userData.id);
                if (user) {
                    appData.currentUser = user;
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('app').style.display = 'block';
                    document.getElementById('userName').textContent = user.name;
                    document.getElementById('userAvatar').textContent = user.avatar;
                    
                    // إظهار أو إخفاء تبويب إدارة المستخدمين بناءً على الصلاحية
                    if (user.role === 'admin') {
                        document.getElementById('usersTab').style.display = 'block';
                        document.getElementById('reportSettingsTab').style.display = 'block';
                    }
                    
                    renderData();
                    
                    // التنقل إلى القسم المحفوظ
                    const savedSection = localStorage.getItem('currentSection') || 'dashboard';
                    navigateToSection(savedSection);
                }
            }
            
            // تحميل البيانات من localStorage إذا كانت موجودة
            loadDataFromStorage();
            
            // إعداد معالج تسجيل الدخول
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // إعداد معالج تسجيل الخروج
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // إعداد التنقل بين الأقسام
            setupNavigation();
            
            // إعداد الأزرار والإجراءات
            setupButtons();
            
            // إعداد الروابط حسب الهاش
            setupHashRouting();
            
            // إعداد قسم تقرير الجودة
            setupQualityReport();
            
            // إعداد قسم إعدادات التقرير
            setupReportSettings();
        });

        // إعداد قسم إعدادات التقرير
        function setupReportSettings() {
            // إعداد علامات التبويب
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // إزالة النشاط من جميع الأزرار
                    document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));
                    
                    // إضافة النشاط للزر المحدد
                    this.classList.add('active');
                    
                    // إخفاء جميع المحتويات
                    document.querySelectorAll('.settings-tab-content').forEach(content => content.classList.remove('active'));
                    
                    // إظهار المحتوى المحدد
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // إعداد أزرار الإضافة
            document.getElementById('addSchoolManager').addEventListener('click', function() {
                showAddReportSettingModal('schoolManager');
            });
            
            document.getElementById('addAssistantManager').addEventListener('click', function() {
                showAddReportSettingModal('assistantManager');
            });
            
            document.getElementById('addVisitor').addEventListener('click', function() {
                showAddReportSettingModal('visitor');
            });
            
            // إعداد نموذج إعدادات التقرير
            document.getElementById('cancelReportSetting').addEventListener('click', closeReportSettingsModal);
            document.querySelector('#reportSettingsModal .close-modal').addEventListener('click', closeReportSettingsModal);
            document.getElementById('reportSettingsForm').addEventListener('submit', saveReportSetting);
            
            // إعداد زر حفظ الإعدادات
            document.getElementById('saveReportSettings').addEventListener('click', saveReportSettings);
            
            // إعداد معالجة تحميل الشعار
            document.getElementById('schoolLogo').addEventListener('change', handleLogoUpload);
            
            // تحميل الإعدادات المحفوظة
            loadReportSettings();
            
            // تعبئة البيانات في النموذج
            document.getElementById('schoolName').value = appData.reportSettings.schoolName;
            document.getElementById('reportFooter').value = appData.reportSettings.reportFooter;
            
            // عرض الشعار إذا كان موجوداً
            if (appData.reportSettings.schoolLogo) {
                document.getElementById('logoPreview').innerHTML = `
                    <img src="${appData.reportSettings.schoolLogo}" alt="شعار المدرسة" style="max-width: 200px; max-height: 100px;">
                `;
            }
            
            // عرض الإعدادات
            renderReportSettings();
        }

        // معالجة تحميل الشعار
        function handleLogoUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                appData.reportSettings.schoolLogo = e.target.result;
                document.getElementById('logoPreview').innerHTML = `
                    <img src="${e.target.result}" alt="شعار المدرسة" style="max-width: 200px; max-height: 100px;">
                `;
            };
            reader.readAsDataURL(file);
        }

        // إعداد قسم تقرير الجودة
        function setupQualityReport() {
            // إعداد علامات التبويب
            document.querySelectorAll('.quality-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // إزالة النشاط من جميع الأزرار
                    document.querySelectorAll('.quality-tab').forEach(t => t.classList.remove('active'));
                    
                    // إضافة النشاط للزر المحدد
                    this.classList.add('active');
                    
                    // إخفاء جميع المحتويات
                    document.querySelectorAll('.quality-tab-content').forEach(content => content.classList.remove('active'));
                    
                    // إظهار المحتوى المحدد
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                    
                    // إذا كانت صفحة التقارير المحفوظة، قم بتحميلها
                    if (tabId === 'saved-quality-reports') {
                        loadSavedQualityReports();
                    }
                });
            });
            
            // تحديث اسم المدرسة في التقرير
            document.getElementById('schoolNameHeader').textContent = `لمدرسة ${appData.qualityReportData.schoolName || 'ــــــــــــــــــــــــــــــــــ'}`;
            
            // تحديث الشهر الحالي
            const currentMonth = new Date().toLocaleDateString('ar-EG', { month: 'long' });
            document.getElementById('reportMonthHeader').textContent = `شهر ${currentMonth}`;
            document.querySelectorAll('.report-section-title').forEach(title => {
                if (title.textContent.includes('شهر')) {
                    title.textContent = title.textContent.replace('____________', currentMonth);
                }
            });

            // تحديث اختيار الشهر
            document.getElementById('reportMonth').value = currentMonth;

            // تحديث الشهر عند التغيير
            document.getElementById('reportMonth').addEventListener('change', function() {
                const selectedMonth = this.value;
                document.getElementById('reportMonthHeader').textContent = `شهر ${selectedMonth}`;
                document.querySelectorAll('.report-section-title').forEach(title => {
                    if (title.textContent.includes('شهر')) {
                        title.textContent = title.textContent.replace(/شهر\s+.+/, `شهر ${selectedMonth}`);
                    }
                });
            });

            // تحميل البيانات المحفوظة
            loadQualityReportData();

            // تعبئة البيانات في النموذج
            document.getElementById('seniorLeadershipVisits').value = appData.qualityReportData.seniorLeadershipVisits;
            document.getElementById('middleLeadershipVisits').value = appData.qualityReportData.middleLeadershipVisits;

            // تعبئة الجداول
            renderMiddleLeadershipReportTable();
            renderTeacherVisitsReportTable();

            // إعداد أزرار التحميل
            document.getElementById('saveQualityReport').addEventListener('click', saveQualityReport);
            document.getElementById('previewQualityReport').addEventListener('click', previewQualityReport);
            document.getElementById('downloadWordReport').addEventListener('click', downloadWordReport);

            // إعداد نافذة المعاينة
            setupQualityPreviewModal();

            // إعداد زر الطباعة
            document.getElementById('printQualityReport').addEventListener('click', printQualityReport);

            // إعداد حقول الإدخال
            document.getElementById('seniorLeadershipVisits').addEventListener('change', updateQualityReport);
            document.getElementById('middleLeadershipVisits').addEventListener('change', updateQualityReport);

            // تحميل البيانات النموذجية تلقائياً
            loadQualityReportSampleData();
        }

        // معاينة التقرير
        function previewQualityReport() {
            updateQualityReport();
            
            const previewContent = document.getElementById('qualityPreviewContent');
            const modal = document.getElementById('qualityPreviewModal');
            
            // إنشاء محتوى المعاينة
            previewContent.innerHTML = generateQualityPreviewContent();
            
            // عرض نافذة المعاينة
            modal.style.display = 'block';
        }

        // طباعة التقرير
        function printQualityReport() {
            const printContent = generatePrintContent();
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
            printWindow.close();
        }

        // إنشاء محتوى الطباعة
        function generatePrintContent() {
            const currentMonth = document.getElementById('reportMonth').value;
            const schoolName = appData.reportSettings.schoolName || 'ــــــــــــــــــــــــــــــــــ';
            const seniorVisits = document.getElementById('seniorLeadershipVisits').value || 0;
            const middleVisits = document.getElementById('middleLeadershipVisits').value || 0;
            
            let content = `
            <!DOCTYPE html>
            <html dir="rtl" lang="ar">
            <head>
                <meta charset="UTF-8">
                <title>تقرير متابعة جودة التعليم والتعلم</title>
                <style>
                    @media print {
                        @page {
                            size: A4;
                            margin: 20mm;
                        }
                        body {
                            font-family: 'Cairo', sans-serif;
                            direction: rtl;
                            line-height: 1.6;
                            margin: 0;
                            padding: 0;
                        }
                        .report-page {
                            width: 210mm;
                            height: 297mm;
                            page-break-after: always;
                            padding: 20mm;
                            margin: 0 auto;
                            box-sizing: border-box;
                            position: relative;
                        }
                        .report-header {
                            text-align: center;
                            margin-bottom: 20px;
                            border-bottom: 2px solid #2c5aa0;
                            padding-bottom: 15px;
                        }
                        .report-title {
                            color: #2c5aa0;
                            font-size: 24px;
                            font-weight: bold;
                            margin-bottom: 10px;
                        }
                        .report-subtitle {
                            color: #6c757d;
                            font-size: 18px;
                            margin-bottom: 5px;
                        }
                        .report-table {
                            width: 100%;
                            border-collapse: collapse;
                            margin-bottom: 15px;
                            font-size: 12px;
                        }
                        .report-table th, .report-table td {
                            border: 1px solid #ddd;
                            padding: 6px;
                            text-align: center;
                        }
                        .report-table th {
                            background-color: #2c5aa0;
                            color: white;
                            font-weight: bold;
                        }
                        .report-section-title {
                            color: #2c5aa0;
                            font-size: 16px;
                            font-weight: bold;
                            margin-top: 20px;
                            margin-bottom: 10px;
                            border-bottom: 1px solid #2c5aa0;
                            padding-bottom: 5px;
                        }
                        .report-footer {
                            position: absolute;
                            bottom: 20mm;
                            left: 20mm;
                            right: 20mm;
                            text-align: center;
                            border-top: 1px solid #ddd;
                            padding-top: 10px;
                            font-size: 14px;
                        }
                        .month-frame {
                            border: 2px solid #2c5aa0;
                            padding: 10px;
                            margin-bottom: 20px;
                            text-align: center;
                            font-weight: bold;
                            font-size: 18px;
                        }
                    }
                </style>
            </head>
            <body>
                <!-- صفحة 1: الغلاف -->
                <div class="report-page">
                    <div class="month-frame">شهر ${currentMonth}</div>
                    ${appData.reportSettings.schoolLogo ? `<div style="text-align: center; margin-bottom: 20px;"><img src="${appData.reportSettings.schoolLogo}" alt="شعار الوزارة" style="max-width: 150px; max-height: 80px;"></div>` : ''}
                    <div class="report-header">
                        <div class="report-title">تقرير متابعة جودة التعليم والتعلم للقيادة العليا والوسطى</div>
                        <div class="report-subtitle">لمدرسة ${schoolName}</div>
                        <div class="report-subtitle">شهر ${currentMonth}</div>
                        <div class="report-subtitle">العام الدراسي 2025 / 2026م</div>
                        <div class="report-subtitle">إعداد المدير/ة المساعد/ة /يعتمد، مدير/ة المدرسة</div>
                    </div>
                    
                    <div style="margin-top: 100px;">
                        ${appData.reportSettings.assistantManagers.length > 0 ? `
                            <p>إعداد المدير/ة المساعد/ة: ${appData.reportSettings.assistantManagers.map(m => m.name).join('، ')}</p>
                        ` : ''}
                        
                        ${appData.reportSettings.schoolManagers.length > 0 ? `
                            <p>يعتمد، مدير/ة المدرسة: ${appData.reportSettings.schoolManagers.map(m => m.name).join('، ')}</p>
                        ` : ''}
                    </div>
                    
                    <div class="report-footer">
                        ${appData.reportSettings.reportFooter}
                    </div>
                </div>
                
                <!-- صفحة 2: متابعة تسليم القيادة الوسطى -->
                <div class="report-page">
                    <div class="report-section-title">أولاً: متابعة تسليم القيادة الوسطى (الزيارات/محاضر الاجتماعات /الخطة الأسبوعية) للمواد الدراسية الى المدير/ة المساعد/ة في المدرسة</div>
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>القسم</th>
                                <th>عدد استمارات الزيارات الصفية التي نفذت من قبل المعلم الأول أو المنسق خلال الشهر</th>
                                <th>يوجد محضر اجتماع المعلم الأول أو المنسق مع المعلمين</th>
                                <th>توجد خطة أسبوعية للمعلم الأول أو المنسق</th>
                                <th>أسباب عدم التسليم</th>
                            </tr>
                        </thead>
                        <tbody>`;
            
            appData.qualityReportData.middleLeadership.forEach(item => {
                content += `<tr>
                    <td>${item.department}</td>
                    <td>${item.visits}</td>
                    <td>${item.meeting}</td>
                    <td>${item.plan}</td>
                    <td>${item.reasons}</td>
                </tr>`;
            });
            
            content += `</tbody></table>
                    <p style="font-style: italic; color: #6c757d; margin-top: 10px; text-align: center;">ملاحظات عامة: يتم التنسيق مع القيادة الوسطى لتنفيذ الزيارات الصفية بحسب ما يتناسب مع ظروف الجداول والنصاب المسند لهم.</p>
                    
                    <div class="report-section-title">ثانياً: عدد الزيارات التي نُفذت خلال شهر ${currentMonth} من قبل:</div>
                    <p>1- القيادة العليا = ${seniorVisits}</p>
                    <p>2- القيادة الوسطى = ${middleVisits}</p>
                    
                    <div class="report-footer">
                        ${appData.reportSettings.reportFooter}
                    </div>
                </div>`;
            
            // صفحة 3: أسماء المعلمين المُزارين
            if (appData.qualityReportData.teacherVisits.length > 0) {
                content += `<div class="report-page">
                    <div class="report-section-title">ثالثاً: بيان أسماء المعلمين المُزارين من قبل القيادة العليا والوسطى خلال شهر ${currentMonth}</div>
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>م</th>
                                <th>اسم المعلم</th>
                                <th>القسم</th>
                                <th>تاريخ الزيارة</th>
                                <th>تقييم الزيارة</th>
                                <th>اسم الزائر</th>
                            </tr>
                        </thead>
                        <tbody>`;
                
                // ترتيب الزيارات حسب ترتيب الزوار في الإعدادات
                const sortedVisits = [...appData.qualityReportData.teacherVisits].sort((a, b) => {
                    const aIndex = appData.reportSettings.visitors.findIndex(v => v.name === a.visitor);
                    const bIndex = appData.reportSettings.visitors.findIndex(v => v.name === b.visitor);
                    return aIndex - bIndex;
                });
                
                sortedVisits.forEach((item, index) => {
                    content += `<tr>
                        <td>${index + 1}</td>
                        <td>${item.teacher}</td>
                        <td>${item.department}</td>
                        <td>${item.date}</td>
                        <td>${item.evaluation}</td>
                        <td>${item.visitor}</td>
                    </tr>`;
                });
                
                content += `</tbody></table>
                    
                    <!-- احتساب المجاميع -->
                    <div style="margin-top: 20px;">`;
                
                // حساب مجاميع الزيارات حسب الزائر
                const visitorCounts = {};
                sortedVisits.forEach(visit => {
                    if (!visitorCounts[visit.visitor]) {
                        visitorCounts[visit.visitor] = 0;
                    }
                    visitorCounts[visit.visitor]++;
                });
                
                Object.keys(visitorCounts).forEach(visitor => {
                    content += `<p>مجموع الزيارات = ${visitorCounts[visitor]}<br>${visitor}</p>`;
                });
                
                content += `<p>المجموع الكلي للزيارات = ${sortedVisits.length}</p>
                    </div>
                    
                    <div class="report-footer">
                        ${appData.reportSettings.reportFooter}
                    </div>
                </div>`;
            }
            
            content += `</body></html>`;
            
            return content;
        }

        // باقي الدوال (نفس الكود السابق مع تحسينات)
        // ... (جميع الدوال السابقة موجودة هنا)

        // دوال العرض للجداول في قسم تقرير الجودة
        function renderMiddleLeadershipReportTable() {
            const table = document.getElementById('middleLeadershipReportTable');
            if (!table) return;
            
            table.innerHTML = '';
            
            // إنشاء بيانات افتراضية إذا لم تكن موجودة
            if (appData.qualityReportData.middleLeadership.length === 0) {
                appData.qualityReportData.middleLeadership = [
                    { department: 'معلم أول / منسق اللغة العربية', visits: 0, meeting: 'نعم', plan: 'نعم', reasons: '' },
                    { department: 'معلم أول/منسق رياضيات وعلوم', visits: 0, meeting: 'نعم', plan: 'نعم', reasons: '' },
                    { department: 'معلم اول/منسق اللغة الإنجليزية', visits: 0, meeting: 'نعم', plan: 'نعم', reasons: '' },
                    { department: 'معلم أول/منسق تربية اسلامية', visits: 0, meeting: 'نعم', plan: 'نعم', reasons: '' },
                    { department: 'معلم اول/منسق المواد الاجتماعية', visits: 0, meeting: 'نعم', plan: 'نعم', reasons: '' },
                    { department: 'معلم أول/منسق نظام فصل', visits: 0, meeting: 'نعم', plan: 'نعم', reasons: '' },
                    { department: 'منسق المواد الإثرائية', visits: 0, meeting: 'نعم', plan: 'نعم', reasons: '' },
                    { department: 'منسق التربية الرياضية', visits: 0, meeting: 'نعم', plan: 'نعم', reasons: '' }
                ];
            }
            
            appData.qualityReportData.middleLeadership.forEach((item, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${item.department}</td>
                    <td><input type="number" class="report-input" value="${item.visits}" data-index="${index}" data-field="visits"></td>
                    <td>
                        <select class="report-input" data-index="${index}" data-field="meeting">
                            <option value="نعم" ${item.meeting === 'نعم' ? 'selected' : ''}>نعم</option>
                            <option value="لا" ${item.meeting === 'لا' ? 'selected' : ''}>لا</option>
                        </select>
                    </td>
                    <td>
                        <select class="report-input" data-index="${index}" data-field="plan">
                            <option value="نعم" ${item.plan === 'نعم' ? 'selected' : ''}>نعم</option>
                            <option value="لا" ${item.plan === 'لا' ? 'selected' : ''}>لا</option>
                        </select>
                    </td>
                    <td><input type="text" class="report-input" value="${item.reasons}" data-index="${index}" data-field="reasons"></td>
                `;
                
                // إضافة مستمعي الأحداث لتحديث البيانات
                const inputs = row.querySelectorAll('input, select');
                inputs.forEach(input => {
                    input.addEventListener('change', function() {
                        const index = this.getAttribute('data-index');
                        const field = this.getAttribute('data-field');
                        appData.qualityReportData.middleLeadership[index][field] = this.value;
                    });
                });
                
                table.appendChild(row);
            });
        }

        function renderTeacherVisitsReportTable() {
            const table = document.getElementById('teacherVisitsReportTable');
            if (!table) return;
            
            table.innerHTML = '';
            
            // إنشاء بيانات افتراضية إذا لم تكن موجودة
            if (appData.qualityReportData.teacherVisits.length === 0) {
                // جلب الزيارات من بيانات التطبيق الرئيسية
                appData.qualityReportData.teacherVisits = appData.visits.map(visit => ({
                    teacher: visit.teacher,
                    department: visit.department,
                    date: visit.date,
                    evaluation: visit.evaluation,
                    visitor: visit.visitor
                }));
            }
            
            appData.qualityReportData.teacherVisits.forEach((item, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><input type="text" class="report-input" value="${item.teacher}" data-index="${index}" data-field="teacher"></td>
                    <td><input type="text" class="report-input" value="${item.department}" data-index="${index}" data-field="department"></td>
                    <td><input type="date" class="report-input" value="${item.date}" data-index="${index}" data-field="date"></td>
                    <td>
                        <select class="report-input" data-index="${index}" data-field="evaluation">
                            <option value="ممتاز" ${item.evaluation === 'ممتاز' ? 'selected' : ''}>ممتاز</option>
                            <option value="جيد جداً" ${item.evaluation === 'جيد جداً' ? 'selected' : ''}>جيد جداً</option>
                            <option value="جيد" ${item.evaluation === 'جيد' ? 'selected' : ''}>جيد</option>
                            <option value="مقبول" ${item.evaluation === 'مقبول' ? 'selected' : ''}>مقبول</option>
                        </select>
                    </td>
                    <td><input type="text" class="report-input" value="${item.visitor}" data-index="${index}" data-field="visitor"></td>
                `;
                
                // إضافة مستمعي الأحداث لتحديث البيانات
                const inputs = row.querySelectorAll('input, select');
                inputs.forEach(input => {
                    input.addEventListener('change', function() {
                        const index = this.getAttribute('data-index');
                        const field = this.getAttribute('data-field');
                        appData.qualityReportData.teacherVisits[index][field] = this.value;
                    });
                });
                
                table.appendChild(row);
            });
        }

        // إنشاء محتوى المعاينة لتقرير الجودة
        function generateQualityPreviewContent() {
            const currentMonth = document.getElementById('reportMonth').value;
            const schoolName = appData.reportSettings.schoolName || 'ــــــــــــــــــــــــــــــــــ';
            const seniorVisits = document.getElementById('seniorLeadershipVisits').value || 0;
            const middleVisits = document.getElementById('middleLeadershipVisits').value || 0;
            
            let content = `
                <div class="report-page">
                    <div class="month-frame">شهر ${currentMonth}</div>
                    ${appData.reportSettings.schoolLogo ? `<div style="text-align: center; margin-bottom: 20px;"><img src="${appData.reportSettings.schoolLogo}" alt="شعار الوزارة" style="max-width: 150px; max-height: 80px;"></div>` : ''}
                    <div class="report-header">
                        <div class="report-title">تقرير متابعة جودة التعليم والتعلم للقيادة العليا والوسطى</div>
                        <div class="report-subtitle">لمدرسة ${schoolName}</div>
                        <div class="report-subtitle">شهر ${currentMonth}</div>
                        <div class="report-subtitle">العام الدراسي 2025 / 2026م</div>
                        <div class="report-subtitle">إعداد المدير/ة المساعد/ة /يعتمد، مدير/ة المدرسة</div>
                    </div>
                    
                    <div style="margin-top: 100px;">
                        ${appData.reportSettings.assistantManagers.length > 0 ? `
                            <p>إعداد المدير/ة المساعد/ة: ${appData.reportSettings.assistantManagers.map(m => m.name).join('، ')}</p>
                        ` : ''}
                        
                        ${appData.reportSettings.schoolManagers.length > 0 ? `
                            <p>يعتمد، مدير/ة المدرسة: ${appData.reportSettings.schoolManagers.map(m => m.name).join('، ')}</p>
                        ` : ''}
                    </div>
                    
                    <div class="report-footer">
                        ${appData.reportSettings.reportFooter}
                    </div>
                </div>
                
                <div class="report-page">
                    <div class="report-section-title">أولاً: متابعة تسليم القيادة الوسطى (الزيارات/محاضر الاجتماعات /الخطة الأسبوعية) للمواد الدراسية الى المدير/ة المساعد/ة في المدرسة</div>
                    <table class="report-table">
                        <thead>
                            <tr>
                                <th>القسم</th>
                                <th>عدد استمارات الزيارات الصفية التي نفذت من قبل المعلم الأول أو المنسق خلال الشهر</th>
                                <th>يوجد محضر اجتماع المعلم الأول أو المنسق مع المعلمين</th>
                                <th>توجد خطة أسبوعية للمعلم الأول أو المنسق</th>
                                <th>أسباب عدم التسليم</th>
                            </tr>
                        </thead>
                        <tbody>`;
            
            appData.qualityReportData.middleLeadership.forEach(item => {
                content += `<tr>
                    <td>${item.department}</td>
                    <td>${item.visits}</td>
                    <td>${item.meeting}</td>
                    <td>${item.plan}</td>
                    <td>${item.reasons}</td>
                </tr>`;
            });
            
            content += `</tbody></table>
                    <p style="font-style: italic; color: #6c757d; margin-top: 10px; text-align: center;">ملاحظات عامة: يتم التنسيق مع القيادة الوسطى لتنفيذ الزيارات الصفية بحسب ما يتناسب مع ظروف الجداول والنصاب المسند لهم.</p>
                    
                    <div class="report-section-title">ثانياً: عدد الزيارات التي نُفذت خلال شهر ${currentMonth} من قبل:</div>
                    <p>1- القيادة العليا = ${seniorVisits}</p>
                    <p>2- القيادة الوسطى = ${middleVisits}</p>
                    
                    <div class="report-footer">
                        ${appData.reportSettings.reportFooter}
                    </div>
                </div>`;
            
            return content;
        }

        // باقي الدوال (نفس الكود السابق)
        // ... (جميع الدوال السابقة موجودة هنا)

    </script>
</body>
</html>
