<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام متابعة جودة التعليم والتعلم</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* جميع الأنماط السابقة تبقى كما هي */
        /* ... */
        
        /* تحديث أنماط صفحة الغلاف لتطابق الصورة المرفقة */
        .report-cover {
            background: white;
            color: black;
            padding: 2.5cm 2cm;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            min-height: 29.7cm;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            box-shadow: var(--box-shadow);
            border: 1px solid #ddd;
        }

        .report-cover-content {
            width: 100%;
            text-align: center;
        }

        .ministry-logo {
            width: 6cm;
            height: 5cm;
            margin: 0 auto 1.5cm;
            display: block;
            object-fit: contain;
        }

        .report-cover-title {
            font-size: 1.8rem;
            margin-bottom: 1.5cm;
            font-weight: 700;
            width: 13cm;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.5;
        }

        .report-cover-subtitle {
            font-size: 1.4rem;
            margin-bottom: 1.5cm;
            font-weight: 600;
        }

        .report-cover-info {
            font-size: 1.2rem;
            margin-bottom: 0.7cm;
            width: 4cm;
            margin-left: auto;
            margin-right: auto;
            border-bottom: 1px solid black;
            padding-bottom: 0.2cm;
            min-height: 0.7cm;
        }

        .report-month-year {
            font-size: 1.2rem;
            margin-bottom: 2.5cm;
            width: 6cm;
            margin-left: auto;
            margin-right: auto;
            display: flex;
            justify-content: center;
            gap: 0.5cm;
        }

        .report-month, .report-year {
            border-bottom: 1px solid black;
            padding-bottom: 0.2cm;
            min-width: 2.5cm;
            min-height: 1cm;
        }

        .report-signatures {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 4.5cm;
            padding: 0 1cm;
        }

        .signature-box {
            text-align: center;
            width: 5cm;
        }

        .signature-label {
            margin-bottom: 0.5cm;
            font-size: 1rem;
        }

        .signature-line {
            width: 100%;
            height: 1px;
            background-color: black;
            margin: 0.5cm auto;
        }

        .signature-name {
            min-height: 1cm;
            border-bottom: 1px solid black;
        }

        .report-footer {
            position: absolute;
            bottom: 1.5cm;
            left: 3cm;
            right: 3cm;
            text-align: center;
            font-size: 0.9rem;
            width: 15cm;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <!-- ... -->
    </div>

    <!-- Main Application -->
    <div id="app" style="display: none;">
        <!-- ... -->
        
        <main>
            <div class="container">
                <!-- Quality Report Section - المحدث -->
                <section id="quality-report" class="section active">
                    <!-- ... -->
                    
                    <!-- صفحة إنشاء التقرير المحدثة -->
                    <div id="create-quality-report" class="quality-tab-content active">
                        <div class="quality-report-section">
                            <!-- إطار تحديد الشهر -->
                            <div class="month-selector-cover">
                                <label for="reportMonthCover">اختر الشهر:</label>
                                <select id="reportMonthCover" class="select-field">
                                    <option value="يناير">يناير</option>
                                    <option value="فبراير">فبراير</option>
                                    <option value="مارس">مارس</option>
                                    <option value="أبريل">أبريل</option>
                                    <option value="مايو">مايو</option>
                                    <option value="يونيو">يونيو</option>
                                    <option value="يوليو">يوليو</option>
                                    <option value="أغسطس">أغسطس</option>
                                    <option value="سبتمبر">سبتمبر</option>
                                    <option value="أكتوبر">أكتوبر</option>
                                    <option value="نوفمبر">نوفمبر</option>
                                    <option value="ديسمبر">ديسمبر</option>
                                </select>
                            </div>

                            <!-- صفحة الغلاف المحدثة لتطابق الصورة -->
                            <div class="report-cover">
                                <div class="report-cover-content">
                                    <!-- شعار الوزارة -->
                                    <img id="ministryLogoPreview" class="ministry-logo" src="" alt="شعار الوزارة" style="display: none;">
                                    
                                    <!-- عنوان التقرير -->
                                    <h1 class="report-cover-title">تقرير متابعة جودة التعليم والتعلم للقيادة العليا والوسطى</h1>
                                    
                                    <!-- اسم المدرسة -->
                                    <div class="report-cover-info" id="schoolNameCover">لمدرسة ______</div>
                                    
                                    <!-- الشهر والعام الدراسي -->
                                    <div class="report-month-year">
                                        <div class="report-month" id="reportMonthCoverText">شهر ______</div>
                                        <div class="report-year" id="academicYearCover">العام الدراسي / 2026م</div>
                                    </div>
                                    
                                    <!-- التوقيعات -->
                                    <div class="report-signatures">
                                        <div class="signature-box">
                                            <div class="signature-label">إعداد المدير/ة المساعد/ة</div>
                                            <div class="signature-line"></div>
                                            <div class="signature-name" id="assistantManagerName">______</div>
                                        </div>
                                        <div class="signature-box">
                                            <div class="signature-label">يُعتمد، مدير/ة المدرسة</div>
                                            <div class="signature-line"></div>
                                            <div class="signature-name" id="schoolManagerName">______</div>
                                        </div>
                                    </div>
                                    
                                    <!-- تذييل الصفحة -->
                                    <div class="report-footer" id="reportFooterCover">
                                        إدارة العمليات التعليمية المنطقة (1) رئيس مدارس. أفنان محمد أمين
                                    </div>
                                </div>
                            </div>

                            <!-- باقي محتوى التقرير يبقى كما هو -->
                            <!-- ... -->
                        </div>
                    </div>
                    
                    <!-- صفحة التقارير المحفوظة -->
                    <div id="saved-quality-reports" class="quality-tab-content">
                        <!-- ... -->
                    </div>
                </section>

                <!-- باقي الأقسام تبقى كما هي -->
                <!-- ... -->
            </div>
        </main>
    </div>

    <!-- النوافذ المنبثقة تبقى كما هي -->
    <!-- ... -->

    <script>
        // جميع الدوال السابقة تبقى كما هي
        // ...

        // إعداد قسم تقرير الجودة
        function setupQualityReport() {
            // إعداد علامات التبويب
            document.querySelectorAll('.quality-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // إزالة النشاط من جميع الأزرار
                    document.querySelectorAll('.quality-tab').forEach(t => t.classList.remove('active'));
                    
                    // إضافة النشاط للزر المحدد
                    this.classList.add('active');
                    
                    // إخفاء جميع المحتويات
                    document.querySelectorAll('.quality-tab-content').forEach(content => content.classList.remove('active'));
                    
                    // إظهار المحتوى المحدد
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                    
                    // إذا كانت صفحة التقارير المحفوظة، قم بتحميلها
                    if (tabId === 'saved-quality-reports') {
                        loadSavedQualityReports();
                    }
                });
            });
            
            // تحديث اسم المدرسة في التقرير
            document.getElementById('schoolNameCover').textContent = `لمدرسة ${appData.reportSettings.schoolName || '______'}`;
            
            // تحديث العام الدراسي في التقرير
            document.getElementById('academicYearCover').textContent = appData.reportSettings.academicYear || 'العام الدراسي / 2026م';
            
            // تحديث أسماء الموقعين
            if (appData.reportSettings.assistantManagers.length > 0) {
                document.getElementById('assistantManagerName').textContent = appData.reportSettings.assistantManagers[0].name;
            } else {
                document.getElementById('assistantManagerName').textContent = '______';
            }
            
            if (appData.reportSettings.schoolManagers.length > 0) {
                document.getElementById('schoolManagerName').textContent = appData.reportSettings.schoolManagers[0].name;
            } else {
                document.getElementById('schoolManagerName').textContent = '______';
            }
            
            // تحديث الشهر الحالي
            const currentMonth = new Date().toLocaleDateString('ar-EG', { month: 'long' });
            document.getElementById('reportMonthCoverText').textContent = `شهر ${currentMonth}`;

            // تحديث الشعار
            if (appData.reportSettings.ministryLogo) {
                document.getElementById('ministryLogoPreview').src = appData.reportSettings.ministryLogo;
                document.getElementById('ministryLogoPreview').style.display = 'block';
            }

            // تحديث التذييل
            document.getElementById('reportFooterCover').textContent = appData.reportSettings.reportFooter || 'إدارة العمليات التعليمية المنطقة (1) رئيس مدارس. أفنان محمد أمين';

            // تحديث اختيار الشهر
            document.getElementById('reportMonthCover').addEventListener('change', function() {
                const selectedMonth = this.value;
                document.getElementById('reportMonthCoverText').textContent = `شهر ${selectedMonth}`;
            });

            // تحميل البيانات المحفوظة
            loadQualityReportData();

            // تعبئة البيانات في النموذج
            document.getElementById('upperLeadershipVisits').value = appData.qualityReportData.seniorLeadershipVisits;
            document.getElementById('middleLeadershipVisits').value = appData.qualityReportData.middleLeadershipVisits;
            document.getElementById('totalClassVisits').value = appData.qualityReportData.totalClassVisits || 0;

            // تعبئة الجداول
            initializeMiddleLeadershipTable();
            initializePerformanceTable();
            initializeQualitativeReportTable();

            // إعداد أزرار التحميل مع تأثيرات الضغط
            const wordBtn = document.getElementById('downloadWordReport');
            const saveBtn = document.getElementById('saveQualityReport');
            const autoFillBtn = document.getElementById('autoFillBtn');
            const generateChartsBtn = document.getElementById('generateChartsBtn');

            // إعداد مستمعي الأحداث للأزرار
            if (wordBtn) {
                wordBtn.addEventListener('click', function(e) {
                    showLoadingEffect(e.target, downloadWordReport);
                });
            }

            if (saveBtn) {
                saveBtn.addEventListener('click', function(e) {
                    showLoadingEffect(e.target, saveQualityReport);
                });
            }

            if (autoFillBtn) {
                autoFillBtn.addEventListener('click', function(e) {
                    showLoadingEffect(e.target, autoFillFromSystem);
                });
            }

            if (generateChartsBtn) {
                generateChartsBtn.addEventListener('click', function(e) {
                    showLoadingEffect(e.target, generateCharts);
                });
            }

            // إعداد نافذة المعاينة
            setupQualityPreviewModal();

            // إعداد حقول الإدخال
            document.getElementById('upperLeadershipVisits').addEventListener('change', updateQualityReport);
            document.getElementById('middleLeadershipVisits').addEventListener('change', updateQualityReport);
            document.getElementById('totalClassVisits').addEventListener('change', updateQualityReport);

            // إعداد فلتر التقارير المحفوظة
            document.getElementById('filterMonth').addEventListener('change', loadSavedQualityReports);
            document.getElementById('sortReports').addEventListener('change', loadSavedQualityReports);

            // إنشاء الرسوم البيانية
            generateCharts();
        }

        // تحديث غلاف التقرير
        function updateReportCover() {
            document.getElementById('schoolNameCover').textContent = `لمدرسة ${appData.reportSettings.schoolName || '______'}`;
            document.getElementById('academicYearCover').textContent = appData.reportSettings.academicYear || 'العام الدراسي / 2026م';
            
            // تحديث أسماء الموقعين
            if (appData.reportSettings.assistantManagers.length > 0) {
                document.getElementById('assistantManagerName').textContent = appData.reportSettings.assistantManagers[0].name;
            } else {
                document.getElementById('assistantManagerName').textContent = '______';
            }
            
            if (appData.reportSettings.schoolManagers.length > 0) {
                document.getElementById('schoolManagerName').textContent = appData.reportSettings.schoolManagers[0].name;
            } else {
                document.getElementById('schoolManagerName').textContent = '______';
            }
        }

        // تحديث تذييل التقرير
        function updateReportFooter() {
            const footerText = document.getElementById('reportFooter').value;
            document.getElementById('footerPreview').textContent = footerText;
            document.getElementById('reportFooterCover').textContent = footerText || 'إدارة العمليات التعليمية المنطقة (1) رئيس مدارس. أفنان محمد أمين';
        }

        // باقي الدوال تبقى كما هي
        // ...
    </script>
</body>
</html>
