<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تقرير تتبع جودة التعليم والتعلم</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
    <style>
        /* نفس الأنماط السابقة... */
        :root {
            --primary: #2c5aa0;
            --primary-light: #4a7bc8;
            --secondary: #4caf50;
            --accent: #ff9800;
            --light: #f5f7fa;
            --dark: #333;
            --gray: #6c757d;
            --danger: #dc3545;
            --success: #28a745;
            --warning: #ffc107;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
        }

        body {
            background-color: #f0f2f5;
            color: var(--dark);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .quality-report-section {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .quality-report-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light);
        }

        .quality-report-title {
            font-size: 1.8rem;
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .quality-report-subtitle {
            font-size: 1.2rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }

        .report-table th {
            background-color: var(--primary);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
        }

        .report-table td {
            padding: 10px 8px;
            border: 1px solid #ddd;
            text-align: center;
        }

        .report-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .report-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 2px solid var(--light);
        }

        .report-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        .report-textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            min-height: 80px;
        }

        .report-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
        }

        .report-section-title {
            font-size: 1.3rem;
            color: var(--primary);
            margin-bottom: 1rem;
            font-weight: 700;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(44, 90, 160, 0.1);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            background-color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: var(--secondary);
        }

        .btn-secondary:hover {
            background-color: #3d8b40;
        }

        .btn-danger {
            background-color: var(--danger);
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-warning {
            background-color: var(--warning);
            color: var(--dark);
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-loading {
            position: relative;
            pointer-events: none;
            opacity: 0.8;
        }

        .btn-loading::after {
            content: "قيد التصوير...";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: inherit;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: inherit;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.6;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0.6;
            }
        }

        .report-notes {
            font-style: italic;
            color: var(--gray);
            margin-top: 1rem;
            text-align: center;
        }

        @media (max-width: 768px) {
            .report-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .report-table {
                font-size: 0.8rem;
            }
            
            .report-table th,
            .report-table td {
                padding: 8px 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="quality-report-section">
            <div class="quality-report-header">
                <h2 class="quality-report-title">تقرير متابعة جودة التعليم والتعلم للقيادة العليا والوسطى</h2>
                <p class="quality-report-subtitle" id="schoolNameHeader">لمدرسة ــــــــــــــــــــــــــــــــــــ</p>
                <p class="quality-report-subtitle" id="reportMonthHeader">شهر ____________</p>
                <p class="quality-report-subtitle" id="academicYearHeader">العام الدراسي 2025 / 2026م</p>
                <p class="quality-report-subtitle">إعداد المدير/ة المساعد/ة /يعتمد، مدير/ة المدرسة</p>
            </div>

            <!-- باقي المحتوى كما هو... -->
            <!-- أولاً: متابعة تسليم القيادة الوسطى -->
            <div class="report-section">
                <h3 class="report-section-title">أولاً: متابعة تسليم القيادة الوسطى (الزيارات/محاضر الاجتماعات /الخطة الأسبوعية) للمواد الدراسية الى المدير/ة المساعد/ة في المدرسة</h3>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>القسم</th>
                            <th>عدد استمارات الزيارات الصفية التي نفذت من قبل المعلم الأول أو المنسق خلال الشهر</th>
                            <th>يوجد محضر اجتماع المعلم الأول أو المنسق مع المعلمين</th>
                            <th>توجد خطة أسبوعية للمعلم الأول أو المنسق</th>
                            <th>أسباب عدم التسليم</th>
                        </tr>
                    </thead>
                    <tbody id="middleLeadershipReportTable">
                        <!-- سيتم ملؤها بالبيانات -->
                    </tbody>
                </table>
                <p class="report-notes">ملاحظات عامة: يتم التنسيق مع القيادة الوسطى لتنفيذ الزيارات الصفية بحسب ما يتناسب مع ظروف الجداول والنصاب المسند لهم.</p>
            </div>

            <!-- ثانياً: عدد الزيارات -->
            <div class="report-section">
                <h3 class="report-section-title">ثانياً: عدد الزيارات التي نُفذت خلال شهر ____________ من قبل:</h3>
                <div class="form-group">
                    <label for="seniorLeadershipVisits">1- القيادة العليا =</label>
                    <input type="number" id="seniorLeadershipVisits" class="report-input" min="0">
                </div>
                <div class="form-group">
                    <label for="middleLeadershipVisits">2- القيادة الوسطى =</label>
                    <input type="number" id="middleLeadershipVisits" class="report-input" min="0">
                </div>
            </div>

            <!-- ثالثاً: أسماء المعلمين المُزارين -->
            <div class="report-section">
                <h3 class="report-section-title">ثالثاً: بيان أسماء المعلمين المُزارين من قبل القيادة العليا والوسطى خلال شهر ____________</h3>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>م</th>
                            <th>اسم المعلم</th>
                            <th>القسم</th>
                            <th>تاريخ الزيارة</th>
                            <th>تقييم الزيارة</th>
                            <th>اسم الزائر</th>
                        </tr>
                    </thead>
                    <tbody id="teacherVisitsReportTable">
                        <!-- سيتم ملؤها بالبيانات -->
                    </tbody>
                </table>
            </div>

            <!-- رابعاً: عدد الزيارات الصفية وتقييم الأداء الصفي -->
            <div class="report-section">
                <h3 class="report-section-title">رابعاً: عدد الزيارات الصفية وتقييم الأداء الصفي</h3>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>م</th>
                            <th>الأقسام الأكاديمية</th>
                            <th>مجموع عدد الزيارات للقسم</th>
                            <th>يفوق التوقعات بكثير</th>
                            <th>يفوق التوقعات</th>
                            <th>يفي بالتوقعات</th>
                            <th>يفي بالتوقعات جزئياً</th>
                        </tr>
                    </thead>
                    <tbody id="performanceReportTable">
                        <!-- سيتم ملؤها بالبيانات -->
                    </tbody>
                </table>
                <div class="form-group">
                    <label for="totalClassVisits">مجموع عدد الزيارات الصفية للقيادة العليا والوسطى</label>
                    <input type="number" id="totalClassVisits" class="report-input" min="0">
                </div>
                <p class="report-notes">رسم بياني يوضح مجموع عدد الزيارات الصفية للقيادة العليا والوسطى</p>
            </div>

            <!-- سادساً: المعلمين المتميزين والأولى بالرعاية -->
            <div class="report-section">
                <h3 class="report-section-title">سادساً: حصر أسماء المعلمين المتميزين في الأقسام الأكاديمية</h3>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>الرقم</th>
                            <th>اسم المعلم</th>
                            <th>التقدير</th>
                            <th>المبررات</th>
                            <th>القسم الأكاديمي</th>
                        </tr>
                    </thead>
                    <tbody id="distinguishedTeachersReportTable">
                        <!-- سيتم ملؤها بالبيانات -->
                    </tbody>
                </table>

                <h4 style="margin-top: 2rem; color: var(--primary);">حصر أسماء المعلمين الأولى بالرعاية في الأقسام الأكاديمية</h4>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>الرقم</th>
                            <th>اسم المعلم</th>
                            <th>التقدير</th>
                            <th>المبررات</th>
                            <th>القسم الأكاديمي</th>
                        </tr>
                    </thead>
                    <tbody id="teachersNeedCareReportTable">
                        <!-- سيتم ملؤها بالبيانات -->
                    </tbody>
                </table>
            </div>

            <!-- سابعاً: التقرير النوعي -->
            <div class="report-section">
                <h3 class="report-section-title">سابعاً: التقرير النوعي</h3>
                <h4>جوانب القوة والتطوير لأداء المعلمين خلال الزيارات الصفية في الأقسام الأكاديمية</h4>
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>الأقسام الأكاديمية</th>
                            <th>جوانب القوة</th>
                            <th>جوانب بحاجة إلى تطوير</th>
                        </tr>
                    </thead>
                    <tbody id="qualityReportTable">
                        <!-- سيتم ملؤها بالبيانات -->
                    </tbody>
                </table>
            </div>

            <!-- أزرار التحميل -->
            <div class="report-actions">
                <button class="btn btn-success" id="downloadWordReport">
                    <i class="fas fa-file-word"></i> تحميل كملف Word
                </button>
                <button class="btn btn-danger" id="downloadPdfReport">
                    <i class="fas fa-file-pdf"></i> تحميل كملف PDF
                </button>
                <button class="btn btn-secondary" id="saveQualityReport">
                    <i class="fas fa-save"></i> حفظ التقرير
                </button>
                <button class="btn btn-warning" id="loadSampleData">
                    <i class="fas fa-download"></i> تحميل بيانات نموذجية
                </button>
            </div>
        </div>
    </div>

    <script>
        // بيانات التقرير
        const qualityReportData = {
            schoolName: '',
            reportMonth: '',
            academicYear: '2025 / 2026م',
            middleLeadership: [],
            seniorLeadershipVisits: 0,
            middleLeadershipVisits: 0,
            teacherVisits: [],
            performance: [],
            distinguishedTeachers: [],
            teachersNeedCare: [],
            qualityReport: [],
            totalClassVisits: 0
        };

        // بيانات نموذجية للاختبار
        const sampleData = {
            seniorLeadershipVisits: 15,
            middleLeadershipVisits: 25,
            totalClassVisits: 40,
            middleLeadership: [
                { department: 'معلم أول / منسق اللغة العربية', visits: 5, meeting: 'نعم', plan: 'نعم', reasons: '' },
                { department: 'معلم أول/منسق رياضيات وعلوم', visits: 6, meeting: 'نعم', plan: 'نعم', reasons: '' },
                { department: 'معلم اول/منسق اللغة الإنجليزية', visits: 4, meeting: 'نعم', plan: 'لا', reasons: 'انشغال المنسق' },
                { department: 'معلم أول/منسق تربية اسلامية', visits: 5, meeting: 'نعم', plan: 'نعم', reasons: '' },
                { department: 'معلم اول/منسق المواد الاجتماعية', visits: 3, meeting: 'لا', plan: 'نعم', reasons: 'تأخر في التسليم' },
                { department: 'معلم أول/منسق نظام فصل', visits: 4, meeting: 'نعم', plan: 'نعم', reasons: '' },
                { department: 'منسق المواد الإثرائية', visits: 2, meeting: 'نعم', plan: 'نعم', reasons: '' },
                { department: 'منسق التربية الرياضية', visits: 3, meeting: 'نعم', plan: 'نعم', reasons: '' }
            ],
            teacherVisits: [
                { teacher: 'أحمد محمد', department: 'اللغة العربية', date: '2025-03-15', evaluation: 'ممتاز', visitor: 'مدير المدرسة' },
                { teacher: 'فاطمة عبدالله', department: 'الرياضيات', date: '2025-03-18', evaluation: 'جيد جداً', visitor: 'نائب المدير' },
                { teacher: 'خالد إبراهيم', department: 'العلوم', date: '2025-03-20', evaluation: 'ممتاز', visitor: 'مدير المدرسة' },
                { teacher: 'سارة علي', department: 'اللغة الإنجليزية', date: '2025-03-22', evaluation: 'جيد', visitor: 'نائب المدير' },
                { teacher: 'محمد حسن', department: 'التربية الإسلامية', date: '2025-03-25', evaluation: 'جيد جداً', visitor: 'مدير المدرسة' }
            ],
            performance: [
                { department: 'قسم الرياضيات', total: 8, excellent: 3, veryGood: 3, good: 2, fair: 0 },
                { department: 'قسم العلوم', total: 7, excellent: 2, veryGood: 3, good: 2, fair: 0 },
                { department: 'قسم اللغة العربية', total: 9, excellent: 4, veryGood: 3, good: 2, fair: 0 },
                { department: 'قسم اللغة الانجليزية', total: 6, excellent: 2, veryGood: 2, good: 2, fair: 0 },
                { department: 'قسم التربية الاسلامية', total: 5, excellent: 2, veryGood: 2, good: 1, fair: 0 },
                { department: 'قسم المواد الاجتماعية', total: 4, excellent: 1, veryGood: 2, good: 1, fair: 0 },
                { department: 'قسم المواد الاثرائية', total: 3, excellent: 1, veryGood: 1, good: 1, fair: 0 },
                { department: 'قسم التربية الرياضية', total: 2, excellent: 1, veryGood: 1, good: 0, fair: 0 },
                { department: 'قسم نظام فصل', total: 2, excellent: 1, veryGood: 1, good: 0, fair: 0 }
            ],
            distinguishedTeachers: [
                { name: 'أحمد محمد', evaluation: 'متميز', reasons: 'تفوق في استخدام استراتيجيات التعلم النشط', department: 'اللغة العربية' },
                { name: 'فاطمة عبدالله', evaluation: 'متميز', reasons: 'إبداع في تصميم الأنشطة الصفية', department: 'الرياضيات' },
                { name: 'خالد إبراهيم', evaluation: 'متميز', reasons: 'تميز في إدارة الصف وتنظيم الوقت', department: 'العلوم' }
            ],
            teachersNeedCare: [
                { name: 'سارة علي', evaluation: 'بحاجة لتطوير', reasons: 'ضعف في إدارة الصف', department: 'اللغة الإنجليزية' },
                { name: 'محمد حسن', evaluation: 'بحاجة لدعم', reasons: 'صعوبة في استخدام التقنية', department: 'التربية الإسلامية' }
            ],
            qualityReport: [
                { department: 'الرياضيات والعلوم', strengths: 'تفعيل استراتيجيات التعلم النشط - استخدام الوسائل التعليمية', improvements: 'تحسين مهارات التقويم - تنويع أساليب التدريس' },
                { department: 'اللغة العربية', strengths: 'تميز في مهارات التواصل - إتقان المادة العلمية', improvements: 'تحسين إدارة الوقت - تنويع الأنشطة' },
                { department: 'اللغة الانجليزية', strengths: 'استخدام اللغة في المواقف الحياتية - تفعيل المحادثة', improvements: 'تحسين نطق بعض الحروف - زيادة الثقة بالنفس' },
                { department: 'التربية الإسلامية', strengths: 'الإلمام بالمادة العلمية - الالتزام بالقيم', improvements: 'تنويع أساليب العرض - استخدام الوسائل التقنية' },
                { department: 'المواد الاجتماعية', strengths: 'ربط المادة بالواقع - استخدام الخرائط', improvements: 'تحسين مهارات العرض - تفعيل التعلم التعاوني' },
                { department: 'المواد الاثرائية', strengths: 'تنوع الأنشطة - تشجيع الإبداع', improvements: 'تحسين التخطيط - توثيق المنجزات' },
                { department: 'التربية الرياضية', strengths: 'تنظيم الحصص - الاهتمام بالسلامة', improvements: 'تنويع الألعاب - تفعيل المنافسات' },
                { department: 'نظام الفصل', strengths: 'تنظيم البيئة الصفية - متابعة الطلاب', improvements: 'تحسين التواصل مع أولياء الأمور - توثيق المتابعة' }
            ]
        };

        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            // إعداد قسم تقرير الجودة
            setupQualityReport();
            
            // إعداد أزرار التحميل مع تأثيرات الضغط
            document.getElementById('downloadWordReport').addEventListener('click', function(e) {
                showLoadingEffect(e.target, downloadWordReport);
            });
            document.getElementById('downloadPdfReport').addEventListener('click', function(e) {
                showLoadingEffect(e.target, downloadPdfReport);
            });
            document.getElementById('saveQualityReport').addEventListener('click', function(e) {
                showLoadingEffect(e.target, saveQualityReport);
            });
            document.getElementById('loadSampleData').addEventListener('click', function(e) {
                showLoadingEffect(e.target, loadSampleData);
            });

            // إعداد حقول الإدخال
            document.getElementById('seniorLeadershipVisits').addEventListener('change', updateQualityReport);
            document.getElementById('middleLeadershipVisits').addEventListener('change', updateQualityReport);
            document.getElementById('totalClassVisits').addEventListener('change', updateQualityReport);
        });

        // وظيفة لإظهار تأثير التحميل
        function showLoadingEffect(button, callback) {
            // إضافة تأثير التحميل
            button.classList.add('btn-loading');
            
            // محاكاة عملية التحميل
            setTimeout(() => {
                // إزالة تأثير التحميل
                button.classList.remove('btn-loading');
                
                // تنفيذ الوظيفة الأصلية
                callback();
            }, 1500); // 1.5 ثانية محاكاة للتصوير
        }

        // إعداد قسم تقرير الجودة
        function setupQualityReport() {
            // تحديث اسم المدرسة في التقرير
            document.getElementById('schoolNameHeader').textContent = `لمدرسة ${qualityReportData.schoolName || 'ــــــــــــــــــــــــــــــــــ'}`;
            
            // تحديث الشهر الحالي
            const currentMonth = new Date().toLocaleDateString('ar-EG', { month: 'long' });
            document.getElementById('reportMonthHeader').textContent = `شهر ${currentMonth}`;
            document.querySelectorAll('.report-section-title').forEach(title => {
                if (title.textContent.includes('شهر')) {
                    title.textContent = title.textContent.replace('____________', currentMonth);
                }
            });

            // تحميل البيانات المحفوظة
            loadQualityReportData();

            // تعبئة البيانات في النموذج
            document.getElementById('seniorLeadershipVisits').value = qualityReportData.seniorLeadershipVisits;
            document.getElementById('middleLeadershipVisits').value = qualityReportData.middleLeadershipVisits;
            document.getElementById('totalClassVisits').value = qualityReportData.totalClassVisits || 0;

            // تعبئة الجداول
            renderMiddleLeadershipReportTable();
            renderTeacherVisitsReportTable();
            renderPerformanceReportTable();
            renderDistinguishedTeachersReportTable();
            renderTeachersNeedCareReportTable();
            renderQualityReportTable();
        }

        // تحميل بيانات تقرير الجودة
        function loadQualityReportData() {
            const savedReport = localStorage.getItem('qualityReportData');
            if (savedReport) {
                const reportData = JSON.parse(savedReport);
                Object.assign(qualityReportData, reportData);
            }
        }

        // تحديث بيانات تقرير الجودة
        function updateQualityReport() {
            qualityReportData.seniorLeadershipVisits = parseInt(document.getElementById('seniorLeadershipVisits').value) || 0;
            qualityReportData.middleLeadershipVisits = parseInt(document.getElementById('middleLeadershipVisits').value) || 0;
            qualityReportData.totalClassVisits = parseInt(document.getElementById('totalClassVisits').value) || 0;
        }

        // حفظ تقرير الجودة
        function saveQualityReport() {
            updateQualityReport();
            localStorage.setItem('qualityReportData', JSON.stringify(qualityReportData));
            alert('تم حفظ تقرير الجودة بنجاح');
        }

        // تحميل بيانات نموذجية
        function loadSampleData() {
            if (confirm('هل تريد تحميل البيانات النموذجية؟ سيتم استبدال جميع البيانات الحالية.')) {
                Object.assign(qualityReportData, JSON.parse(JSON.stringify(sampleData)));
                
                // تحديث الحقول
                document.getElementById('seniorLeadershipVisits').value = qualityReportData.seniorLeadershipVisits;
                document.getElementById('middleLeadershipVisits').value = qualityReportData.middleLeadershipVisits;
                document.getElementById('totalClassVisits').value = qualityReportData.totalClassVisits;
                
                // إعادة تعبئة الجداول
                renderMiddleLeadershipReportTable();
                renderTeacherVisitsReportTable();
                renderPerformanceReportTable();
                renderDistinguishedTeachersReportTable();
                renderTeachersNeedCareReportTable();
                renderQualityReportTable();
                
                alert('تم تحميل البيانات النموذجية بنجاح');
            }
        }

        // باقي دوول العرض كما هي...
        // [جميع دوول render... تبقى كما هي]

        // تحميل التقرير كملف Word - الإصدار المحسن
        function downloadWordReport() {
            try {
                // جمع البيانات من النموذج أولاً
                updateQualityReport();
                
                // إنشاء محتوى نصي بسيط للتقرير
                const reportContent = generateSimpleReportContent();
                
                // استخدام تنسيق نصي بسيط بدلاً من HTML معقد
                const blob = new Blob([reportContent], { 
                    type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document;charset=UTF-8' 
                });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                const currentMonth = new Date().toLocaleDateString('ar-EG', { month: 'long' });
                a.href = url;
                a.download = `تقرير_جودة_التعليم_${currentMonth}.docx`;
                
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('تم تنزيل التقرير كملف Word بنجاح');
            } catch (error) {
                console.error('Error generating Word file:', error);
                alert('حدث خطأ أثناء إنشاء ملف Word. جاري استخدام تنسيق بديل...');
                downloadWordReportAlternative();
            }
        }

        // بديل لتنزيل Word كنص عادي
        function downloadWordReportAlternative() {
            try {
                const reportContent = generateSimpleReportContent();
                const blob = new Blob(['\uFEFF' + reportContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                const currentMonth = new Date().toLocaleDateString('ar-EG', { month: 'long' });
                a.href = url;
                a.download = `تقرير_جودة_التعليم_${currentMonth}.txt`;
                
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                alert('تم تنزيل التقرير كملف نصي. يمكنك نسخ المحتوى إلى Word يدوياً.');
            } catch (error) {
                console.error('Error generating alternative file:', error);
                alert('فشل في إنشاء الملف. يرجى المحاولة مرة أخرى.');
            }
        }

        // تحميل التقرير كملف PDF - الإصدار المحسن
        function downloadPdfReport() {
            try {
                updateQualityReport();
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // إضافة دعم للغة العربية
                doc.setLanguage('ar');
                
                let yPosition = 20;
                
                // عنوان التقرير
                doc.setFontSize(16);
                doc.setTextColor(44, 90, 160);
                doc.text('تقرير متابعة جودة التعليم والتعلم', 105, yPosition, { align: 'center' });
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.setTextColor(100, 100, 100);
                doc.text(`لمدرسة ${qualityReportData.schoolName || 'ــــــــــــــــــــــــــــــــــ'}`, 105, yPosition, { align: 'center' });
                yPosition += 7;
                
                const currentMonth = new Date().toLocaleDateString('ar-EG', { month: 'long' });
                doc.text(`شهر ${currentMonth}`, 105, yPosition, { align: 'center' });
                yPosition += 7;
                doc.text('العام الدراسي 2025 / 2026م', 105, yPosition, { align: 'center' });
                yPosition += 15;
                
                // بيانات الزيارات
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(14);
                doc.text('إحصائيات الزيارات:', 20, yPosition);
                yPosition += 10;
                
                doc.setFontSize(12);
                doc.text(`• عدد زيارات القيادة العليا: ${qualityReportData.seniorLeadershipVisits}`, 20, yPosition);
                yPosition += 7;
                doc.text(`• عدد زيارات القيادة الوسطى: ${qualityReportData.middleLeadershipVisits}`, 20, yPosition);
                yPosition += 7;
                doc.text(`• إجمالي الزيارات الصفية: ${qualityReportData.totalClassVisits}`, 20, yPosition);
                yPosition += 15;
                
                // المعلمين المتميزين
                if (qualityReportData.distinguishedTeachers.length > 0) {
                    doc.setFontSize(14);
                    doc.text('المعلمين المتميزين:', 20, yPosition);
                    yPosition += 10;
                    
                    doc.setFontSize(10);
                    qualityReportData.distinguishedTeachers.forEach((teacher, index) => {
                        if (yPosition > 270) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        doc.text(`${index + 1}. ${teacher.name} - ${teacher.department}`, 25, yPosition);
                        yPosition += 6;
                    });
                    yPosition += 10;
                }
                
                // تذييل الصفحة
                const currentDate = new Date().toLocaleDateString('ar-EG');
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`تم إنشاء هذا التقرير بتاريخ ${currentDate}`, 105, 285, { align: 'center' });
                
                // حفظ الملف
                doc.save(`تقرير_جودة_التعليم_${currentMonth}.pdf`);
                
                alert('تم تنزيل التقرير كملف PDF بنجاح');
            } catch (error) {
                console.error('Error generating PDF file:', error);
                alert('حدث خطأ أثناء إنشاء ملف PDF');
            }
        }

        // إنشاء محتوى نصي بسيط للتقرير
        function generateSimpleReportContent() {
            const currentMonth = new Date().toLocaleDateString('ar-EG', { month: 'long' });
            const currentDate = new Date().toLocaleDateString('ar-EG');
            
            let content = `تقرير متابعة جودة التعليم والتعلم للقيادة العليا والوسطى\n`;
            content += `==================================================\n\n`;
            content += `المدرسة: ${qualityReportData.schoolName || 'ــــــــــــــــــــــــــــــــــ'}\n`;
            content += `الشهر: ${currentMonth}\n`;
            content += `العام الدراسي: 2025 / 2026م\n\n`;
            
            content += `إحصائيات الزيارات:\n`;
            content += `------------------\n`;
            content += `• عدد زيارات القيادة العليا: ${qualityReportData.seniorLeadershipVisits}\n`;
            content += `• عدد زيارات القيادة الوسطى: ${qualityReportData.middleLeadershipVisits}\n`;
            content += `• إجمالي الزيارات الصفية: ${qualityReportData.totalClassVisits}\n\n`;
            
            if (qualityReportData.distinguishedTeachers.length > 0) {
                content += `المعلمين المتميزين:\n`;
                content += `-------------------\n`;
                qualityReportData.distinguishedTeachers.forEach((teacher, index) => {
                    content += `${index + 1}. ${teacher.name} - ${teacher.department}\n`;
                    content += `   التقدير: ${teacher.evaluation}\n`;
                    content += `   المبررات: ${teacher.reasons}\n\n`;
                });
            }
            
            if (qualityReportData.teachersNeedCare.length > 0) {
                content += `المعلمين الأولى بالرعاية:\n`;
                content += `-----------------------\n`;
                qualityReportData.teachersNeedCare.forEach((teacher, index) => {
                    content += `${index + 1}. ${teacher.name} - ${teacher.department}\n`;
                    content += `   التقدير: ${teacher.evaluation}\n`;
                    content += `   المبررات: ${teacher.reasons}\n\n`;
                });
            }
            
            content += `\nتم إنشاء هذا التقرير بتاريخ ${currentDate}\n`;
            content += `إعداد المدير/ة المساعد/ة /يعتمد، مدير/ة المدرسة\n`;
            
            return content;
        }

        // [جميع دوول render الأخرى تبقى كما هي...]
    </script>
</body>
</html>
